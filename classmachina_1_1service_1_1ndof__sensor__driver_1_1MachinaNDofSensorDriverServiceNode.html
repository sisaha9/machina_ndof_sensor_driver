<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Siddharth Saha&#39;s NDoF Sensor Driver for Machina Labs: machina::service::ndof_sensor_driver::MachinaNDofSensorDriverServiceNode Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Siddharth Saha&#39;s NDoF Sensor Driver for Machina Labs
   &#160;<span id="projectnumber">v1.0.0</span>
   </div>
   <div id="projectbrief">ROS 2 Driver for Machina Labs&#39; NDoF Sensor</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacemachina.html">machina</a></li><li class="navelem"><a class="el" href="namespacemachina_1_1service.html">service</a></li><li class="navelem"><a class="el" href="namespacemachina_1_1service_1_1ndof__sensor__driver.html">ndof_sensor_driver</a></li><li class="navelem"><a class="el" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html">MachinaNDofSensorDriverServiceNode</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">machina::service::ndof_sensor_driver::MachinaNDofSensorDriverServiceNode Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>LifecycleNode to provide service to get latest sensor data.  
 <a href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="machina__ndof__sensor__driver__service__node_8hpp_source.html">machina_ndof_sensor_driver_service_node.hpp</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for machina::service::ndof_sensor_driver::MachinaNDofSensorDriverServiceNode:</div>
<div class="dyncontent">
<div class="center"><img src="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode__inherit__graph.png" border="0" usemap="#amachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode_inherit__map" alt="Inheritance graph"/></div>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for machina::service::ndof_sensor_driver::MachinaNDofSensorDriverServiceNode:</div>
<div class="dyncontent">
<div class="center"><img src="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode__coll__graph.png" border="0" usemap="#amachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode_coll__map" alt="Collaboration graph"/></div>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a40b66f9802fbd3cc3c5ce9a4c928fe6e"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a40b66f9802fbd3cc3c5ce9a4c928fe6e">MachinaNDofSensorDriverServiceNode</a> (const rclcpp::NodeOptions &amp;options)</td></tr>
<tr class="memdesc:a40b66f9802fbd3cc3c5ce9a4c928fe6e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Construct a new <a class="el" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html" title="LifecycleNode to provide service to get latest sensor data.">MachinaNDofSensorDriverServiceNode</a> object.  <a href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a40b66f9802fbd3cc3c5ce9a4c928fe6e">More...</a><br /></td></tr>
<tr class="separator:a40b66f9802fbd3cc3c5ce9a4c928fe6e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a70278e05b171c1bd866a086961129f30"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a70278e05b171c1bd866a086961129f30">~MachinaNDofSensorDriverServiceNode</a> ()</td></tr>
<tr class="memdesc:a70278e05b171c1bd866a086961129f30"><td class="mdescLeft">&#160;</td><td class="mdescRight">Destroy the <a class="el" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html" title="LifecycleNode to provide service to get latest sensor data.">MachinaNDofSensorDriverServiceNode</a> object.  <a href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a70278e05b171c1bd866a086961129f30">More...</a><br /></td></tr>
<tr class="separator:a70278e05b171c1bd866a086961129f30"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a410950b60c5de369039aaee01407277c"><td class="memItemLeft" align="right" valign="top">rclcpp_lifecycle::node_interfaces::LifecycleNodeInterface::CallbackReturn&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a410950b60c5de369039aaee01407277c">on_configure</a> (const rclcpp_lifecycle::State &amp;previous_state) override</td></tr>
<tr class="memdesc:a410950b60c5de369039aaee01407277c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback for the configure lifecycle transition.  <a href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a410950b60c5de369039aaee01407277c">More...</a><br /></td></tr>
<tr class="separator:a410950b60c5de369039aaee01407277c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a93fca07b5706709e6f0e20515afc21e7"><td class="memItemLeft" align="right" valign="top">rclcpp_lifecycle::node_interfaces::LifecycleNodeInterface::CallbackReturn&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a93fca07b5706709e6f0e20515afc21e7">on_activate</a> (const rclcpp_lifecycle::State &amp;previous_state) override</td></tr>
<tr class="memdesc:a93fca07b5706709e6f0e20515afc21e7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback for the activate lifecycle transition.  <a href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a93fca07b5706709e6f0e20515afc21e7">More...</a><br /></td></tr>
<tr class="separator:a93fca07b5706709e6f0e20515afc21e7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a881abdd7b55fea13527b756d3eb847b2"><td class="memItemLeft" align="right" valign="top">rclcpp_lifecycle::node_interfaces::LifecycleNodeInterface::CallbackReturn&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a881abdd7b55fea13527b756d3eb847b2">on_deactivate</a> (const rclcpp_lifecycle::State &amp;previous_state) override</td></tr>
<tr class="memdesc:a881abdd7b55fea13527b756d3eb847b2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback for the deactivate lifecycle transition.  <a href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a881abdd7b55fea13527b756d3eb847b2">More...</a><br /></td></tr>
<tr class="separator:a881abdd7b55fea13527b756d3eb847b2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5e083873cee963647feb09fe1ceeac39"><td class="memItemLeft" align="right" valign="top">rclcpp_lifecycle::node_interfaces::LifecycleNodeInterface::CallbackReturn&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a5e083873cee963647feb09fe1ceeac39">on_shutdown</a> (const rclcpp_lifecycle::State &amp;previous_state) override</td></tr>
<tr class="memdesc:a5e083873cee963647feb09fe1ceeac39"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback for the shutdown lifecycle transition.  <a href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a5e083873cee963647feb09fe1ceeac39">More...</a><br /></td></tr>
<tr class="separator:a5e083873cee963647feb09fe1ceeac39"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a108ba02785ea86152d248032400a27a1"><td class="memItemLeft" align="right" valign="top">rclcpp_lifecycle::node_interfaces::LifecycleNodeInterface::CallbackReturn&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a108ba02785ea86152d248032400a27a1">on_cleanup</a> (const rclcpp_lifecycle::State &amp;previous_state) override</td></tr>
<tr class="memdesc:a108ba02785ea86152d248032400a27a1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback for the cleanup lifecycle transition.  <a href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a108ba02785ea86152d248032400a27a1">More...</a><br /></td></tr>
<tr class="separator:a108ba02785ea86152d248032400a27a1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acdb10708761dbd5704a17d5ec038866f"><td class="memItemLeft" align="right" valign="top">rclcpp_lifecycle::node_interfaces::LifecycleNodeInterface::CallbackReturn&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#acdb10708761dbd5704a17d5ec038866f">on_error</a> (const rclcpp_lifecycle::State &amp;previous_state) override</td></tr>
<tr class="memdesc:acdb10708761dbd5704a17d5ec038866f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback for the error lifecycle transition.  <a href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#acdb10708761dbd5704a17d5ec038866f">More...</a><br /></td></tr>
<tr class="separator:acdb10708761dbd5704a17d5ec038866f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:aa3eb41495db665f1ae65d161707e269c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#aa3eb41495db665f1ae65d161707e269c">ReadSensorDataContinuously</a> ()</td></tr>
<tr class="memdesc:aa3eb41495db665f1ae65d161707e269c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function to read sensor data continuously.  <a href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#aa3eb41495db665f1ae65d161707e269c">More...</a><br /></td></tr>
<tr class="separator:aa3eb41495db665f1ae65d161707e269c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a58c419900bb87d61362e1594f0777462"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a58c419900bb87d61362e1594f0777462">GetLatestSensorData</a> (const std::shared_ptr&lt; machina_ndof_sensor_driver_msgs::srv::GetLatestSensorData::Request &gt; request, std::shared_ptr&lt; machina_ndof_sensor_driver_msgs::srv::GetLatestSensorData::Response &gt; response)</td></tr>
<tr class="memdesc:a58c419900bb87d61362e1594f0777462"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback for the get latest sensor data service.  <a href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a58c419900bb87d61362e1594f0777462">More...</a><br /></td></tr>
<tr class="separator:a58c419900bb87d61362e1594f0777462"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:ad19471695861a3d4c2da5b9c562b230c"><td class="memItemLeft" align="right" valign="top">std::unique_ptr&lt; <a class="el" href="classmachina_1_1tcp__interface_1_1TcpInterface.html">machina::tcp_interface::TcpInterface</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#ad19471695861a3d4c2da5b9c562b230c">tcp_interface_</a></td></tr>
<tr class="memdesc:ad19471695861a3d4c2da5b9c562b230c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Pointer to the TCP interface.  <a href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#ad19471695861a3d4c2da5b9c562b230c">More...</a><br /></td></tr>
<tr class="separator:ad19471695861a3d4c2da5b9c562b230c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae42d116b769ecd12f04139eb0d97e9d2"><td class="memItemLeft" align="right" valign="top">std::unique_ptr&lt; ros_parameters::ParamListener &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#ae42d116b769ecd12f04139eb0d97e9d2">param_listener_</a></td></tr>
<tr class="memdesc:ae42d116b769ecd12f04139eb0d97e9d2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Pointer to the ROS 2 parameter listener. Uses the generate_parameter_library package to generate the parameters in a less verbose way.  <a href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#ae42d116b769ecd12f04139eb0d97e9d2">More...</a><br /></td></tr>
<tr class="separator:ae42d116b769ecd12f04139eb0d97e9d2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a24ef7b5a804785e4e64e125a8382f3e4"><td class="memItemLeft" align="right" valign="top">ros_parameters::Params&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a24ef7b5a804785e4e64e125a8382f3e4">ros_params_</a></td></tr>
<tr class="memdesc:a24ef7b5a804785e4e64e125a8382f3e4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Structure to hold the ROS 2 parameters retrieved from the parameter listener.  <a href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a24ef7b5a804785e4e64e125a8382f3e4">More...</a><br /></td></tr>
<tr class="separator:a24ef7b5a804785e4e64e125a8382f3e4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a194b2c9aab529e9c5c02aa186284fcc3"><td class="memItemLeft" align="right" valign="top">std::shared_mutex&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a194b2c9aab529e9c5c02aa186284fcc3">latest_sensor_data_mutex_</a></td></tr>
<tr class="memdesc:a194b2c9aab529e9c5c02aa186284fcc3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Mutex to protect the latest sensor data.  <a href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a194b2c9aab529e9c5c02aa186284fcc3">More...</a><br /></td></tr>
<tr class="separator:a194b2c9aab529e9c5c02aa186284fcc3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3206ca9b5242a2a070bc36ca29ed5616"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structmachina_1_1service_1_1ndof__sensor__driver_1_1NDofSensorData.html">NDofSensorData</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a3206ca9b5242a2a070bc36ca29ed5616">latest_sensor_data_</a></td></tr>
<tr class="memdesc:a3206ca9b5242a2a070bc36ca29ed5616"><td class="mdescLeft">&#160;</td><td class="mdescRight">Structure to hold the latest sensor data.  <a href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a3206ca9b5242a2a070bc36ca29ed5616">More...</a><br /></td></tr>
<tr class="separator:a3206ca9b5242a2a070bc36ca29ed5616"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9fd6c38d36ccfeb6e2eec81b14e3b690"><td class="memItemLeft" align="right" valign="top">rclcpp::Service&lt; machina_ndof_sensor_driver_msgs::srv::GetLatestSensorData &gt;::SharedPtr&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a9fd6c38d36ccfeb6e2eec81b14e3b690">sensor_data_service_</a></td></tr>
<tr class="memdesc:a9fd6c38d36ccfeb6e2eec81b14e3b690"><td class="mdescLeft">&#160;</td><td class="mdescRight">Service to get the latest sensor data.  <a href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a9fd6c38d36ccfeb6e2eec81b14e3b690">More...</a><br /></td></tr>
<tr class="separator:a9fd6c38d36ccfeb6e2eec81b14e3b690"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2ec5b9fe3ede4f05decc116c1bf5c592"><td class="memItemLeft" align="right" valign="top">uint8_t *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a2ec5b9fe3ede4f05decc116c1bf5c592">sample_size_buffer_</a></td></tr>
<tr class="memdesc:a2ec5b9fe3ede4f05decc116c1bf5c592"><td class="mdescLeft">&#160;</td><td class="mdescRight">Buffer to hold the sample size of the sensor data.  <a href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a2ec5b9fe3ede4f05decc116c1bf5c592">More...</a><br /></td></tr>
<tr class="separator:a2ec5b9fe3ede4f05decc116c1bf5c592"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a51bf0902a53eae1a83efef5c86d8e515"><td class="memItemLeft" align="right" valign="top">double *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a51bf0902a53eae1a83efef5c86d8e515">sensor_data_buffer_</a></td></tr>
<tr class="memdesc:a51bf0902a53eae1a83efef5c86d8e515"><td class="mdescLeft">&#160;</td><td class="mdescRight">Buffer to hold the sensor data.  <a href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a51bf0902a53eae1a83efef5c86d8e515">More...</a><br /></td></tr>
<tr class="separator:a51bf0902a53eae1a83efef5c86d8e515"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aff435bda6d57fa91d446d23fd9a6d079"><td class="memItemLeft" align="right" valign="top">std::thread&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#aff435bda6d57fa91d446d23fd9a6d079">sensor_data_thread_</a></td></tr>
<tr class="memdesc:aff435bda6d57fa91d446d23fd9a6d079"><td class="mdescLeft">&#160;</td><td class="mdescRight">Thread to read sensor data continuously.  <a href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#aff435bda6d57fa91d446d23fd9a6d079">More...</a><br /></td></tr>
<tr class="separator:aff435bda6d57fa91d446d23fd9a6d079"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6e6c150997e60dc549284ca9ae455953"><td class="memItemLeft" align="right" valign="top">std::atomic&lt; bool &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a6e6c150997e60dc549284ca9ae455953">sensor_data_thread_running_</a> {false}</td></tr>
<tr class="memdesc:a6e6c150997e60dc549284ca9ae455953"><td class="mdescLeft">&#160;</td><td class="mdescRight">Atomic to check if the sensor data thread is running.  <a href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a6e6c150997e60dc549284ca9ae455953">More...</a><br /></td></tr>
<tr class="separator:a6e6c150997e60dc549284ca9ae455953"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>LifecycleNode to provide service to get latest sensor data. </p>
<p>Uses the <a class="el" href="classmachina_1_1tcp__interface_1_1TcpInterface.html">machina::tcp_interface::TcpInterface</a> to read sensor data and advertise a service to serve the latest sensor data. A thread is spawned to read sensor data continuously and store it. When a service request is received, the latest sensor data is served. Since this is concurrent, we have defined 2 modes of operation:</p><ul>
<li>Lock-free using TACO from iceoryx (<a href="https://iceoryx.io/latest/advanced/iceoryx_hoofs/#concurrent">https://iceoryx.io/latest/advanced/iceoryx_hoofs/#concurrent</a>)</li>
<li>Using shared_mutex You can toggle between these modes by setting -DENABLE_LOCKFREE to ON/OFF ON for lock-free and OFF for shared_mutex. More experiments and data needs to be collected but right now TACO enables a significant speedup but it blocks access to the data often at high frequencies. Thinking of swapping to a 2 element container in the future so that the producer can always write to the 2nd element. If the 2nd element is being written to (can use atomic to check) then the consumer can read from the 1st element. This way we can avoid blocking. This is a future update.</li>
</ul>
<p>The node also uses the Lifecycle Design Pattern (<a href="https://design.ros2.org/articles/node_lifecycle.html">https://design.ros2.org/articles/node_lifecycle.html</a>) That means the node won't start just by the typical ros2 run routine. You need to call the lifecycle transitions configure and activate to enter nominal operation. Refer to the documentation for more details. <a href="https://github.com/ros2/demos/blob/iron/lifecycle/README.rst">https://github.com/ros2/demos/blob/iron/lifecycle/README.rst</a></p>
<p>The node also uses the Composition Design Pattern (<a href="https://docs.ros.org/en/iron/Concepts/Intermediate/About-Composition.html">https://docs.ros.org/en/iron/Concepts/Intermediate/About-Composition.html</a>) Ideally, this would mean there is a zero copy transfer of data between nodes in the same component container. However, I am not sure if that applies in the case of service-client relationship.</p>
<p>A future update to be made here is to use TypeAdapters to reduce the number of memory copies. If we have 2 nodes in the same container and use type adapters, we could get the data, send it in the exact same format to the other node and it can use it directly. This would be a zero copy </p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a40b66f9802fbd3cc3c5ce9a4c928fe6e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a40b66f9802fbd3cc3c5ce9a4c928fe6e">&#9670;&nbsp;</a></span>MachinaNDofSensorDriverServiceNode()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">machina::service::ndof_sensor_driver::MachinaNDofSensorDriverServiceNode::MachinaNDofSensorDriverServiceNode </td>
          <td>(</td>
          <td class="paramtype">const rclcpp::NodeOptions &amp;&#160;</td>
          <td class="paramname"><em>options</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">explicit</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Construct a new <a class="el" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html" title="LifecycleNode to provide service to get latest sensor data.">MachinaNDofSensorDriverServiceNode</a> object. </p>
<p>The main node option I am interested in is use_intraprocess_comms. This is exposed in the launch file under the package machina_ndof_sensor_driver_system_tests.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">options</td><td>NodeOptions for the node </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    : rclcpp_lifecycle::LifecycleNode(<span class="stringliteral">&quot;machina_ndof_sensor_driver_service_node&quot;</span>,</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;                                      options)</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#ifdef ENABLE_LOCKFREE</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;      ,</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;      sensor_data_taco_(iox::concurrent::TACOMode::DenyDataFromSameContext)</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;{</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  <span class="comment">// Initialize the TCP interface and the parameter listener</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  <a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#ad19471695861a3d4c2da5b9c562b230c">tcp_interface_</a> = std::make_unique&lt;machina::tcp_interface::TcpInterface&gt;();</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  <a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#ae42d116b769ecd12f04139eb0d97e9d2">param_listener_</a> = std::make_unique&lt;ros_parameters::ParamListener&gt;(</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;      this-&gt;get_node_parameters_interface());</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  RCLCPP_INFO(get_logger(),</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;              <span class="stringliteral">&quot;Machina NDof Sensor Driver Service Node Constructed&quot;</span>);</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;}</div>
<div class="ttc" id="aclassmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode_html_ad19471695861a3d4c2da5b9c562b230c"><div class="ttname"><a href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#ad19471695861a3d4c2da5b9c562b230c">machina::service::ndof_sensor_driver::MachinaNDofSensorDriverServiceNode::tcp_interface_</a></div><div class="ttdeci">std::unique_ptr&lt; machina::tcp_interface::TcpInterface &gt; tcp_interface_</div><div class="ttdoc">Pointer to the TCP interface.</div><div class="ttdef"><b>Definition:</b> machina_ndof_sensor_driver_service_node.hpp:179</div></div>
<div class="ttc" id="aclassmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode_html_ae42d116b769ecd12f04139eb0d97e9d2"><div class="ttname"><a href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#ae42d116b769ecd12f04139eb0d97e9d2">machina::service::ndof_sensor_driver::MachinaNDofSensorDriverServiceNode::param_listener_</a></div><div class="ttdeci">std::unique_ptr&lt; ros_parameters::ParamListener &gt; param_listener_</div><div class="ttdoc">Pointer to the ROS 2 parameter listener. Uses the generate_parameter_library package to generate the ...</div><div class="ttdef"><b>Definition:</b> machina_ndof_sensor_driver_service_node.hpp:185</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a70278e05b171c1bd866a086961129f30"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a70278e05b171c1bd866a086961129f30">&#9670;&nbsp;</a></span>~MachinaNDofSensorDriverServiceNode()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">machina::service::ndof_sensor_driver::MachinaNDofSensorDriverServiceNode::~MachinaNDofSensorDriverServiceNode </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Destroy the <a class="el" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html" title="LifecycleNode to provide service to get latest sensor data.">MachinaNDofSensorDriverServiceNode</a> object. </p>
<div class="fragment"><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;                                                                        {</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  <span class="comment">// Clean up the TCP interface and the parameter listener</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  <span class="comment">// Also delete the sample size buffer which is the only new object created</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  <span class="keyword">delete</span>[] <a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a2ec5b9fe3ede4f05decc116c1bf5c592">sample_size_buffer_</a>;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  <a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#ad19471695861a3d4c2da5b9c562b230c">tcp_interface_</a>.reset();</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  <a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#ae42d116b769ecd12f04139eb0d97e9d2">param_listener_</a>.reset();</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;}</div>
<div class="ttc" id="aclassmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode_html_a2ec5b9fe3ede4f05decc116c1bf5c592"><div class="ttname"><a href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a2ec5b9fe3ede4f05decc116c1bf5c592">machina::service::ndof_sensor_driver::MachinaNDofSensorDriverServiceNode::sample_size_buffer_</a></div><div class="ttdeci">uint8_t * sample_size_buffer_</div><div class="ttdoc">Buffer to hold the sample size of the sensor data.</div><div class="ttdef"><b>Definition:</b> machina_ndof_sensor_driver_service_node.hpp:230</div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a58c419900bb87d61362e1594f0777462"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a58c419900bb87d61362e1594f0777462">&#9670;&nbsp;</a></span>GetLatestSensorData()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void machina::service::ndof_sensor_driver::MachinaNDofSensorDriverServiceNode::GetLatestSensorData </td>
          <td>(</td>
          <td class="paramtype">const std::shared_ptr&lt; machina_ndof_sensor_driver_msgs::srv::GetLatestSensorData::Request &gt;&#160;</td>
          <td class="paramname"><em>request</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::shared_ptr&lt; machina_ndof_sensor_driver_msgs::srv::GetLatestSensorData::Response &gt;&#160;</td>
          <td class="paramname"><em>response</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Callback for the get latest sensor data service. </p>
<p>This function is called when a service request is received. It serves the latest sensor data </p>
<div class="fragment"><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;                  {</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;  (void)request;</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="preprocessor">#ifdef ENABLE_LOCKFREE</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;  <span class="comment">// If we are using lockfree data structures, we need to get the latest sensor</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;  <span class="comment">// data from the TACO</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;  NDofSensorData <a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a3206ca9b5242a2a070bc36ca29ed5616">latest_sensor_data_</a>;</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;  <span class="keyword">auto</span> ret_val = sensor_data_taco_.take(ThreadContext::Consumer);</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;  <span class="keywordflow">if</span> (ret_val.has_value()) {</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a3206ca9b5242a2a070bc36ca29ed5616">latest_sensor_data_</a> = *ret_val;</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    response-&gt;sensor_data_filled = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    RCLCPP_WARN(get_logger(), <span class="stringliteral">&quot;Failed to get sensor data from TACO&quot;</span>);</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  }</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;  <span class="comment">// If we are not using lockfree data structures, we need to share lock before</span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;  <span class="comment">// reading the latest sensor data</span></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;  <a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a194b2c9aab529e9c5c02aa186284fcc3">latest_sensor_data_mutex_</a>.lock_shared();</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  <span class="comment">// Check if the sensor data has been received. If not, log an error and</span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;  <span class="comment">// set the response to false</span></div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a3206ca9b5242a2a070bc36ca29ed5616">latest_sensor_data_</a>.<a class="code" href="structmachina_1_1service_1_1ndof__sensor__driver_1_1NDofSensorData.html#a4be5e5795f692bf2cd8ead672c18ee8d">timestamp</a>.get_clock_type() ==</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;      RCL_CLOCK_UNINITIALIZED) {</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    response-&gt;sensor_data_filled = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    RCLCPP_ERROR(get_logger(), <span class="stringliteral">&quot;Sensor data not yet received&quot;</span>);</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a6e6c150997e60dc549284ca9ae455953">sensor_data_thread_running_</a>.load()) {</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    <span class="comment">// If the sensor data has been received but the thread is not running, log</span></div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <span class="comment">// an error and set the response to false</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    response-&gt;sensor_data_filled = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    RCLCPP_ERROR(</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;        get_logger(),</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;        <span class="stringliteral">&quot;Sensor data not being collected. Likely in deactivated state&quot;</span>);</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    <span class="comment">// If the sensor data has been received, set the response to true and</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    <span class="comment">// fill the sensor data</span></div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    response-&gt;sensor_data_filled = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    response-&gt;sensor.data = <a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a3206ca9b5242a2a070bc36ca29ed5616">latest_sensor_data_</a>.<a class="code" href="structmachina_1_1service_1_1ndof__sensor__driver_1_1NDofSensorData.html#a799258a81e52e6913433c451e1674fbc">data</a>;</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    response-&gt;sensor.header.stamp = <a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a3206ca9b5242a2a070bc36ca29ed5616">latest_sensor_data_</a>.<a class="code" href="structmachina_1_1service_1_1ndof__sensor__driver_1_1NDofSensorData.html#a4be5e5795f692bf2cd8ead672c18ee8d">timestamp</a>;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    response-&gt;sensor.header.frame_id = <a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a24ef7b5a804785e4e64e125a8382f3e4">ros_params_</a>.frame_id;</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  }</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="preprocessor">#ifndef ENABLE_LOCKFREE</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;  <span class="comment">// If we are not using lockfree data structures, we need to unlock the shared</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;  <span class="comment">// lock now</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;  <a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a194b2c9aab529e9c5c02aa186284fcc3">latest_sensor_data_mutex_</a>.unlock_shared();</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;}</div>
<div class="ttc" id="aclassmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode_html_a194b2c9aab529e9c5c02aa186284fcc3"><div class="ttname"><a href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a194b2c9aab529e9c5c02aa186284fcc3">machina::service::ndof_sensor_driver::MachinaNDofSensorDriverServiceNode::latest_sensor_data_mutex_</a></div><div class="ttdeci">std::shared_mutex latest_sensor_data_mutex_</div><div class="ttdoc">Mutex to protect the latest sensor data.</div><div class="ttdef"><b>Definition:</b> machina_ndof_sensor_driver_service_node.hpp:208</div></div>
<div class="ttc" id="aclassmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode_html_a24ef7b5a804785e4e64e125a8382f3e4"><div class="ttname"><a href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a24ef7b5a804785e4e64e125a8382f3e4">machina::service::ndof_sensor_driver::MachinaNDofSensorDriverServiceNode::ros_params_</a></div><div class="ttdeci">ros_parameters::Params ros_params_</div><div class="ttdoc">Structure to hold the ROS 2 parameters retrieved from the parameter listener.</div><div class="ttdef"><b>Definition:</b> machina_ndof_sensor_driver_service_node.hpp:190</div></div>
<div class="ttc" id="aclassmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode_html_a3206ca9b5242a2a070bc36ca29ed5616"><div class="ttname"><a href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a3206ca9b5242a2a070bc36ca29ed5616">machina::service::ndof_sensor_driver::MachinaNDofSensorDriverServiceNode::latest_sensor_data_</a></div><div class="ttdeci">NDofSensorData latest_sensor_data_</div><div class="ttdoc">Structure to hold the latest sensor data.</div><div class="ttdef"><b>Definition:</b> machina_ndof_sensor_driver_service_node.hpp:215</div></div>
<div class="ttc" id="aclassmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode_html_a6e6c150997e60dc549284ca9ae455953"><div class="ttname"><a href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a6e6c150997e60dc549284ca9ae455953">machina::service::ndof_sensor_driver::MachinaNDofSensorDriverServiceNode::sensor_data_thread_running_</a></div><div class="ttdeci">std::atomic&lt; bool &gt; sensor_data_thread_running_</div><div class="ttdoc">Atomic to check if the sensor data thread is running.</div><div class="ttdef"><b>Definition:</b> machina_ndof_sensor_driver_service_node.hpp:259</div></div>
<div class="ttc" id="astructmachina_1_1service_1_1ndof__sensor__driver_1_1NDofSensorData_html_a4be5e5795f692bf2cd8ead672c18ee8d"><div class="ttname"><a href="structmachina_1_1service_1_1ndof__sensor__driver_1_1NDofSensorData.html#a4be5e5795f692bf2cd8ead672c18ee8d">machina::service::ndof_sensor_driver::NDofSensorData::timestamp</a></div><div class="ttdeci">rclcpp::Time timestamp</div><div class="ttdef"><b>Definition:</b> machina_ndof_sensor_driver_service_node.hpp:59</div></div>
<div class="ttc" id="astructmachina_1_1service_1_1ndof__sensor__driver_1_1NDofSensorData_html_a799258a81e52e6913433c451e1674fbc"><div class="ttname"><a href="structmachina_1_1service_1_1ndof__sensor__driver_1_1NDofSensorData.html#a799258a81e52e6913433c451e1674fbc">machina::service::ndof_sensor_driver::NDofSensorData::data</a></div><div class="ttdeci">example_interfaces::msg::Float64MultiArray data</div><div class="ttdef"><b>Definition:</b> machina_ndof_sensor_driver_service_node.hpp:58</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a93fca07b5706709e6f0e20515afc21e7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a93fca07b5706709e6f0e20515afc21e7">&#9670;&nbsp;</a></span>on_activate()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">rclcpp_lifecycle::node_interfaces::LifecycleNodeInterface::CallbackReturn machina::service::ndof_sensor_driver::MachinaNDofSensorDriverServiceNode::on_activate </td>
          <td>(</td>
          <td class="paramtype">const rclcpp_lifecycle::State &amp;&#160;</td>
          <td class="paramname"><em>previous_state</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Callback for the activate lifecycle transition. </p>
<p>Starts the sensor data thread and the service </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">previous_state</td><td>The previous state of the node </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;                                                 {</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  (void)previous_state;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  <span class="comment">// Advertising the service to respond to requests for the latest sensor data</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  <a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a9fd6c38d36ccfeb6e2eec81b14e3b690">sensor_data_service_</a> = this-&gt;create_service&lt;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;      machina_ndof_sensor_driver_msgs::srv::GetLatestSensorData&gt;(</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;      <span class="stringliteral">&quot;get_latest_sensor_data&quot;</span>,</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;      std::bind(&amp;<a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a58c419900bb87d61362e1594f0777462">MachinaNDofSensorDriverServiceNode::GetLatestSensorData</a>, <span class="keyword">this</span>,</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;                std::placeholders::_1, std::placeholders::_2),</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;      rclcpp::ServicesQoS());</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  RCLCPP_INFO(get_logger(),</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;              <span class="stringliteral">&quot;Machina NDof Sensor Driver Service Node Activated&quot;</span>);</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  <span class="comment">// Start the thread to read sensor data continuously</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  <a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a6e6c150997e60dc549284ca9ae455953">sensor_data_thread_running_</a>.store(<span class="keyword">true</span>);</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  <a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#aff435bda6d57fa91d446d23fd9a6d079">sensor_data_thread_</a> = std::thread(</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;      &amp;<a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#aa3eb41495db665f1ae65d161707e269c">MachinaNDofSensorDriverServiceNode::ReadSensorDataContinuously</a>, <span class="keyword">this</span>);</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  <span class="keywordflow">return</span> rclcpp_lifecycle::node_interfaces::LifecycleNodeInterface::</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;      CallbackReturn::SUCCESS;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;}</div>
<div class="ttc" id="aclassmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode_html_a58c419900bb87d61362e1594f0777462"><div class="ttname"><a href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a58c419900bb87d61362e1594f0777462">machina::service::ndof_sensor_driver::MachinaNDofSensorDriverServiceNode::GetLatestSensorData</a></div><div class="ttdeci">void GetLatestSensorData(const std::shared_ptr&lt; machina_ndof_sensor_driver_msgs::srv::GetLatestSensorData::Request &gt; request, std::shared_ptr&lt; machina_ndof_sensor_driver_msgs::srv::GetLatestSensorData::Response &gt; response)</div><div class="ttdoc">Callback for the get latest sensor data service.</div><div class="ttdef"><b>Definition:</b> machina_ndof_sensor_driver_service_node.cpp:320</div></div>
<div class="ttc" id="aclassmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode_html_a9fd6c38d36ccfeb6e2eec81b14e3b690"><div class="ttname"><a href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a9fd6c38d36ccfeb6e2eec81b14e3b690">machina::service::ndof_sensor_driver::MachinaNDofSensorDriverServiceNode::sensor_data_service_</a></div><div class="ttdeci">rclcpp::Service&lt; machina_ndof_sensor_driver_msgs::srv::GetLatestSensorData &gt;::SharedPtr sensor_data_service_</div><div class="ttdoc">Service to get the latest sensor data.</div><div class="ttdef"><b>Definition:</b> machina_ndof_sensor_driver_service_node.hpp:221</div></div>
<div class="ttc" id="aclassmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode_html_aa3eb41495db665f1ae65d161707e269c"><div class="ttname"><a href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#aa3eb41495db665f1ae65d161707e269c">machina::service::ndof_sensor_driver::MachinaNDofSensorDriverServiceNode::ReadSensorDataContinuously</a></div><div class="ttdeci">void ReadSensorDataContinuously()</div><div class="ttdoc">Function to read sensor data continuously.</div><div class="ttdef"><b>Definition:</b> machina_ndof_sensor_driver_service_node.cpp:175</div></div>
<div class="ttc" id="aclassmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode_html_aff435bda6d57fa91d446d23fd9a6d079"><div class="ttname"><a href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#aff435bda6d57fa91d446d23fd9a6d079">machina::service::ndof_sensor_driver::MachinaNDofSensorDriverServiceNode::sensor_data_thread_</a></div><div class="ttdeci">std::thread sensor_data_thread_</div><div class="ttdoc">Thread to read sensor data continuously.</div><div class="ttdef"><b>Definition:</b> machina_ndof_sensor_driver_service_node.hpp:251</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a108ba02785ea86152d248032400a27a1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a108ba02785ea86152d248032400a27a1">&#9670;&nbsp;</a></span>on_cleanup()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">rclcpp_lifecycle::node_interfaces::LifecycleNodeInterface::CallbackReturn machina::service::ndof_sensor_driver::MachinaNDofSensorDriverServiceNode::on_cleanup </td>
          <td>(</td>
          <td class="paramtype">const rclcpp_lifecycle::State &amp;&#160;</td>
          <td class="paramname"><em>previous_state</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Callback for the cleanup lifecycle transition. </p>
<p>Stops the TCP connection and resets the service pointer</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">previous_state</td><td>The previous state of the node </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;                                                 {</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  (void)previous_state;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  <span class="comment">// Close the TCP connection and reset the service</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  <a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#ad19471695861a3d4c2da5b9c562b230c">tcp_interface_</a>-&gt;CloseConnection();</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  <a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a9fd6c38d36ccfeb6e2eec81b14e3b690">sensor_data_service_</a>.reset();</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  RCLCPP_INFO(get_logger(),</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;              <span class="stringliteral">&quot;Machina NDof Sensor Driver Service Node Cleaned Up&quot;</span>);</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  <span class="keywordflow">return</span> rclcpp_lifecycle::node_interfaces::LifecycleNodeInterface::</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;      CallbackReturn::SUCCESS;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a410950b60c5de369039aaee01407277c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a410950b60c5de369039aaee01407277c">&#9670;&nbsp;</a></span>on_configure()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">rclcpp_lifecycle::node_interfaces::LifecycleNodeInterface::CallbackReturn machina::service::ndof_sensor_driver::MachinaNDofSensorDriverServiceNode::on_configure </td>
          <td>(</td>
          <td class="paramtype">const rclcpp_lifecycle::State &amp;&#160;</td>
          <td class="paramname"><em>previous_state</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Callback for the configure lifecycle transition. </p>
<p>Used to preallocate memory, start the TCP interface and retrieve ROS 2 parameters </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">previous_state</td><td>The previous state of the node </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;                                                 {</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  (void)previous_state;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  <span class="comment">// Retrieve the parameters. Right now all parameters are frozen on startup</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  <span class="comment">// so there is no need to call this function again</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  <a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a24ef7b5a804785e4e64e125a8382f3e4">ros_params_</a> = <a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#ae42d116b769ecd12f04139eb0d97e9d2">param_listener_</a>-&gt;get_params();</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  <span class="comment">// Create the sample size buffer. It will store 8 bytes to send as a sample</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  <span class="comment">// size</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  <a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a2ec5b9fe3ede4f05decc116c1bf5c592">sample_size_buffer_</a> = <span class="keyword">new</span> uint8_t[<span class="keyword">sizeof</span>(uint64_t)];</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  <span class="comment">// Convert the requested sample size to a byte array. Since the sample size</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  <span class="comment">// is constant for the lifetime of the node, we can do this once</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  uint64_t req_sample_size =</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;      <span class="keyword">static_cast&lt;</span>uint64_t<span class="keyword">&gt;</span>(<a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a24ef7b5a804785e4e64e125a8382f3e4">ros_params_</a>.requested_sample_size);</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  <span class="comment">// Copy the bytes to the allocated buffer</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  std::memcpy(<a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a2ec5b9fe3ede4f05decc116c1bf5c592">sample_size_buffer_</a>, &amp;req_sample_size, <span class="keyword">sizeof</span>(uint64_t));</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  <span class="comment">// Attempt to connect to the sensor. If the connection fails, retry</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  <span class="comment">// @ref ros_params_.max_connection_attempts times</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  uint64_t num_attempts = 0;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  <span class="keywordflow">while</span> (!<a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#ad19471695861a3d4c2da5b9c562b230c">tcp_interface_</a>-&gt;StartConnection(<a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a24ef7b5a804785e4e64e125a8382f3e4">ros_params_</a>.sensor.ip_addr,</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;                                          <a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a24ef7b5a804785e4e64e125a8382f3e4">ros_params_</a>.sensor.port) &amp;&amp;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;         num_attempts &lt;=</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;             <span class="keyword">static_cast&lt;</span>uint64_t<span class="keyword">&gt;</span>(<a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a24ef7b5a804785e4e64e125a8382f3e4">ros_params_</a>.max_connection_attempts)) {</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    RCLCPP_ERROR(get_logger(), <span class="stringliteral">&quot;Failed to connect to sensor. Retrying...&quot;</span>);</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <span class="comment">// Sleep for the connection retry interval</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    std::this_thread::sleep_for(</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        std::chrono::milliseconds(<a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a24ef7b5a804785e4e64e125a8382f3e4">ros_params_</a>.connection_retry_interval));</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    num_attempts++;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  }</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  <span class="comment">// If the number of attempts exceeds the maximum allowed, log a fatal error</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  <span class="comment">// and return failure</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  <span class="keywordflow">if</span> (num_attempts &gt;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;      <span class="keyword">static_cast&lt;</span>uint64_t<span class="keyword">&gt;</span>(<a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a24ef7b5a804785e4e64e125a8382f3e4">ros_params_</a>.max_connection_attempts)) {</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    RCLCPP_FATAL(get_logger(), <span class="stringliteral">&quot;Failed to connect to sensor. Exiting...&quot;</span>);</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <span class="keywordflow">return</span> rclcpp_lifecycle::node_interfaces::LifecycleNodeInterface::</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        CallbackReturn::FAILURE;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  }</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  RCLCPP_INFO(get_logger(),</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;              <span class="stringliteral">&quot;Machina NDof Sensor Driver Service Node Configured&quot;</span>);</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  <span class="keywordflow">return</span> rclcpp_lifecycle::node_interfaces::LifecycleNodeInterface::</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;      CallbackReturn::SUCCESS;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a881abdd7b55fea13527b756d3eb847b2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a881abdd7b55fea13527b756d3eb847b2">&#9670;&nbsp;</a></span>on_deactivate()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">rclcpp_lifecycle::node_interfaces::LifecycleNodeInterface::CallbackReturn machina::service::ndof_sensor_driver::MachinaNDofSensorDriverServiceNode::on_deactivate </td>
          <td>(</td>
          <td class="paramtype">const rclcpp_lifecycle::State &amp;&#160;</td>
          <td class="paramname"><em>previous_state</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Callback for the deactivate lifecycle transition. </p>
<p>Stops the sensor data thread. The service is still active but will no longer fill sensor data</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">previous_state</td><td>The previous state of the node </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;                                                 {</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  (void)previous_state;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  <span class="comment">// Stop the thread to read sensor data continuously</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  <a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a6e6c150997e60dc549284ca9ae455953">sensor_data_thread_running_</a>.store(<span class="keyword">false</span>);</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  <a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#aff435bda6d57fa91d446d23fd9a6d079">sensor_data_thread_</a>.join();</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  RCLCPP_INFO(get_logger(),</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;              <span class="stringliteral">&quot;Machina NDof Sensor Driver Service Node Deactivated&quot;</span>);</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  <span class="keywordflow">return</span> rclcpp_lifecycle::node_interfaces::LifecycleNodeInterface::</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;      CallbackReturn::SUCCESS;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="acdb10708761dbd5704a17d5ec038866f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acdb10708761dbd5704a17d5ec038866f">&#9670;&nbsp;</a></span>on_error()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">rclcpp_lifecycle::node_interfaces::LifecycleNodeInterface::CallbackReturn machina::service::ndof_sensor_driver::MachinaNDofSensorDriverServiceNode::on_error </td>
          <td>(</td>
          <td class="paramtype">const rclcpp_lifecycle::State &amp;&#160;</td>
          <td class="paramname"><em>previous_state</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Callback for the error lifecycle transition. </p>
<p>Calls the <a class="el" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a5e083873cee963647feb09fe1ceeac39">on_shutdown</a> function which right now calls the cleanup function</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">previous_state</td><td>The previous state of the node </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;                                                 {</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  (void)previous_state;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  <span class="comment">// Call the shutdown function to clean up and log an error message</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  <a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a5e083873cee963647feb09fe1ceeac39">on_shutdown</a>(previous_state);</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  RCLCPP_INFO(get_logger(), <span class="stringliteral">&quot;Machina NDof Sensor Driver Service Node Errored&quot;</span>);</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  <span class="keywordflow">return</span> rclcpp_lifecycle::node_interfaces::LifecycleNodeInterface::</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;      CallbackReturn::SUCCESS;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;}</div>
<div class="ttc" id="aclassmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode_html_a5e083873cee963647feb09fe1ceeac39"><div class="ttname"><a href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a5e083873cee963647feb09fe1ceeac39">machina::service::ndof_sensor_driver::MachinaNDofSensorDriverServiceNode::on_shutdown</a></div><div class="ttdeci">rclcpp_lifecycle::node_interfaces::LifecycleNodeInterface::CallbackReturn on_shutdown(const rclcpp_lifecycle::State &amp;previous_state) override</div><div class="ttdoc">Callback for the shutdown lifecycle transition.</div><div class="ttdef"><b>Definition:</b> machina_ndof_sensor_driver_service_node.cpp:137</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a5e083873cee963647feb09fe1ceeac39"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5e083873cee963647feb09fe1ceeac39">&#9670;&nbsp;</a></span>on_shutdown()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">rclcpp_lifecycle::node_interfaces::LifecycleNodeInterface::CallbackReturn machina::service::ndof_sensor_driver::MachinaNDofSensorDriverServiceNode::on_shutdown </td>
          <td>(</td>
          <td class="paramtype">const rclcpp_lifecycle::State &amp;&#160;</td>
          <td class="paramname"><em>previous_state</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Callback for the shutdown lifecycle transition. </p>
<p>Just calls the <a class="el" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a108ba02785ea86152d248032400a27a1">on_cleanup</a> function</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">previous_state</td><td>The previous state of the node </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;                                                 {</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  (void)previous_state;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  <span class="comment">// Call the cleanup function to close the connection and reset the service</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  <a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a108ba02785ea86152d248032400a27a1">on_cleanup</a>(previous_state);</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;  RCLCPP_INFO(get_logger(),</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;              <span class="stringliteral">&quot;Machina NDof Sensor Driver Service Node Shut Down&quot;</span>);</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  <span class="keywordflow">return</span> rclcpp_lifecycle::node_interfaces::LifecycleNodeInterface::</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;      CallbackReturn::SUCCESS;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;}</div>
<div class="ttc" id="aclassmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode_html_a108ba02785ea86152d248032400a27a1"><div class="ttname"><a href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a108ba02785ea86152d248032400a27a1">machina::service::ndof_sensor_driver::MachinaNDofSensorDriverServiceNode::on_cleanup</a></div><div class="ttdeci">rclcpp_lifecycle::node_interfaces::LifecycleNodeInterface::CallbackReturn on_cleanup(const rclcpp_lifecycle::State &amp;previous_state) override</div><div class="ttdoc">Callback for the cleanup lifecycle transition.</div><div class="ttdef"><b>Definition:</b> machina_ndof_sensor_driver_service_node.cpp:150</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa3eb41495db665f1ae65d161707e269c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa3eb41495db665f1ae65d161707e269c">&#9670;&nbsp;</a></span>ReadSensorDataContinuously()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void machina::service::ndof_sensor_driver::MachinaNDofSensorDriverServiceNode::ReadSensorDataContinuously </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Function to read sensor data continuously. </p>
<p>This function is called in the sensor_data_thread_ and reads sensor data continuously. </p>
<div class="fragment"><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;                                                                    {</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="preprocessor">#ifndef ENABLE_LOCKFREE</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  <span class="comment">// If we are not using lockfree data structures, we need to lock the mutex</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  <span class="comment">// before allocating the latest sensor data since the ROS 2 service callback</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  <span class="comment">// will be reading from it</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  <a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a194b2c9aab529e9c5c02aa186284fcc3">latest_sensor_data_mutex_</a>.lock();</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  <span class="comment">// If we are using lockfree data structures, we need to allocate the latest</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  <span class="comment">// sensor data and store it in the TACO before starting to read sensor data</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  NDofSensorData <a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a3206ca9b5242a2a070bc36ca29ed5616">latest_sensor_data_</a>;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  <span class="comment">// Set to uninitialized as a way to keep track of if we have received any</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  <span class="comment">// sensor data</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  <a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a3206ca9b5242a2a070bc36ca29ed5616">latest_sensor_data_</a>.<a class="code" href="structmachina_1_1service_1_1ndof__sensor__driver_1_1NDofSensorData.html#a4be5e5795f692bf2cd8ead672c18ee8d">timestamp</a> = rclcpp::Time(0, 0, RCL_CLOCK_UNINITIALIZED);</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  <span class="comment">// Allocate the data vector to store the sensor data. It is 2D with the first</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  <span class="comment">// dimension being the degrees of freedom and the second dimension being the</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;  <span class="comment">// requested sample size</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;  <a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a3206ca9b5242a2a070bc36ca29ed5616">latest_sensor_data_</a>.<a class="code" href="structmachina_1_1service_1_1ndof__sensor__driver_1_1NDofSensorData.html#a799258a81e52e6913433c451e1674fbc">data</a>.data.reserve(<a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a24ef7b5a804785e4e64e125a8382f3e4">ros_params_</a>.requested_sample_size *</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;                                        <a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a24ef7b5a804785e4e64e125a8382f3e4">ros_params_</a>.degrees_of_freedom);</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;  <span class="comment">// Set the layout of the data</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;  example_interfaces::msg::MultiArrayLayout layout;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;  example_interfaces::msg::MultiArrayDimension dim;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  dim.size = <a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a24ef7b5a804785e4e64e125a8382f3e4">ros_params_</a>.degrees_of_freedom;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  dim.stride = <a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a24ef7b5a804785e4e64e125a8382f3e4">ros_params_</a>.requested_sample_size;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;  dim.label = <span class="stringliteral">&quot;degrees_of_freedom&quot;</span>;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;  <a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a3206ca9b5242a2a070bc36ca29ed5616">latest_sensor_data_</a>.<a class="code" href="structmachina_1_1service_1_1ndof__sensor__driver_1_1NDofSensorData.html#a799258a81e52e6913433c451e1674fbc">data</a>.layout.dim.push_back(dim);</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;  dim.size = <a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a24ef7b5a804785e4e64e125a8382f3e4">ros_params_</a>.requested_sample_size;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  dim.stride = 1;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  dim.label = <span class="stringliteral">&quot;requested_sample_size&quot;</span>;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  <a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a3206ca9b5242a2a070bc36ca29ed5616">latest_sensor_data_</a>.<a class="code" href="structmachina_1_1service_1_1ndof__sensor__driver_1_1NDofSensorData.html#a799258a81e52e6913433c451e1674fbc">data</a>.layout.dim.push_back(dim);</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  <a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a3206ca9b5242a2a070bc36ca29ed5616">latest_sensor_data_</a>.<a class="code" href="structmachina_1_1service_1_1ndof__sensor__driver_1_1NDofSensorData.html#a799258a81e52e6913433c451e1674fbc">data</a>.layout.data_offset = 0;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="preprocessor">#ifndef ENABLE_LOCKFREE</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  <span class="comment">// If we are not using lockfree data structures, we need to unlock the mutex</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;  <span class="comment">// before starting to read sensor data. The ROS 2 service can read the data</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;  <span class="comment">// now if it was trying to. But it will see the uninitialized timestamp and</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;  <span class="comment">// know that the data is not yet available</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  <a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a194b2c9aab529e9c5c02aa186284fcc3">latest_sensor_data_mutex_</a>.unlock();</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  <span class="comment">// If we are using lockfree data structures, we need to store the latest</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;  <span class="comment">// sensor data in the TACO before starting to read sensor data. The ROS 2</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;  <span class="comment">// service can read the data now if it was trying to. But it will see the</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;  <span class="comment">// uninitialized timestamp and know that the data is not yet available.</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  sensor_data_taco_.store(<a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a3206ca9b5242a2a070bc36ca29ed5616">latest_sensor_data_</a>, ThreadContext::Producer);</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  <span class="comment">// Start reading sensor data continuously. We are using the boolean flag to</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;  <span class="comment">// control the loop. If the flag is set to false, we will exit the loop and</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  <span class="comment">// stop reading sensor data enabling a clean shutdown</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;  <span class="keywordflow">while</span> (<a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a6e6c150997e60dc549284ca9ae455953">sensor_data_thread_running_</a>.load()) {</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <span class="comment">// Debug purposes to see how long it takes to read sensor data</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <span class="keyword">auto</span> start_time = now();</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <span class="comment">// Send the sample size to the sensor</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <span class="keywordtype">bool</span> send_res =</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        <a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#ad19471695861a3d4c2da5b9c562b230c">tcp_interface_</a>-&gt;SendData(<a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a2ec5b9fe3ede4f05decc116c1bf5c592">sample_size_buffer_</a>, <span class="keyword">sizeof</span>(uint64_t));</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="comment">// If the number of bytes sent is not equal to the size of the sample size</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <span class="comment">// buffer, log an error. Undefined what happens with the sensor now. We</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    <span class="comment">// do check the number of bytes received from the sensor later on so we can</span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <span class="comment">// validate if something went wrong</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <span class="keywordflow">if</span> (!send_res) {</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;      RCLCPP_ERROR(get_logger(), <span class="stringliteral">&quot;Sent wrong number of bytes to sensor&quot;</span>);</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    }</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="preprocessor">#ifndef ENABLE_LOCKFREE</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <span class="comment">// If we are not using lockfree data structures, we need to lock the mutex</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <span class="comment">// before allocating the latest sensor data since the ROS 2 service</span></div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="comment">// callback will be reading from it</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a194b2c9aab529e9c5c02aa186284fcc3">latest_sensor_data_mutex_</a>.lock();</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <span class="comment">// Allocate the data buffer to store the sensor data</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    uint8_t* data_buffer =</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        <span class="keyword">reinterpret_cast&lt;</span>uint8_t*<span class="keyword">&gt;</span>(<a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a3206ca9b5242a2a070bc36ca29ed5616">latest_sensor_data_</a>.<a class="code" href="structmachina_1_1service_1_1ndof__sensor__driver_1_1NDofSensorData.html#a799258a81e52e6913433c451e1674fbc">data</a>.data.data());</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    uint64_t data_len = <a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a24ef7b5a804785e4e64e125a8382f3e4">ros_params_</a>.requested_sample_size *</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                        <a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a24ef7b5a804785e4e64e125a8382f3e4">ros_params_</a>.degrees_of_freedom * <span class="keyword">sizeof</span>(double);</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <span class="comment">// Receive the sensor data</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    uint64_t received_len = <a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#ad19471695861a3d4c2da5b9c562b230c">tcp_interface_</a>-&gt;ReceiveData(data_buffer, data_len);</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    <span class="comment">// If the number of bytes received is not equal to the size of the data</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    <span class="comment">// buffer, log an error and continue. Undefined what we have received</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <span class="keywordflow">if</span> (received_len != <a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a24ef7b5a804785e4e64e125a8382f3e4">ros_params_</a>.requested_sample_size *</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;                            <a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a24ef7b5a804785e4e64e125a8382f3e4">ros_params_</a>.degrees_of_freedom * <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)) {</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;      RCLCPP_ERROR(get_logger(), <span class="stringliteral">&quot;Received wrong number of bytes from sensor&quot;</span>);</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;      RCLCPP_ERROR(get_logger(), <span class="stringliteral">&quot;Expected %ld and received %ld&quot;</span>,</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                   <a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a24ef7b5a804785e4e64e125a8382f3e4">ros_params_</a>.requested_sample_size *</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                       <a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a24ef7b5a804785e4e64e125a8382f3e4">ros_params_</a>.degrees_of_freedom * <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>),</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                   received_len);</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    }</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <span class="comment">// If we have reached here things look good so far</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <span class="comment">// Set the timestamp to the current time. Ideally, the sensor should be</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <span class="comment">// PTP synchronized with the ROS 2 system and we should get the hardware</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <span class="comment">// timestamp from when the sensor hit the network</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <span class="comment">// But for now, we will use the time we received</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a3206ca9b5242a2a070bc36ca29ed5616">latest_sensor_data_</a>.<a class="code" href="structmachina_1_1service_1_1ndof__sensor__driver_1_1NDofSensorData.html#a4be5e5795f692bf2cd8ead672c18ee8d">timestamp</a> = now();</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <span class="comment">// Set the data vector to the received data buffer</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a3206ca9b5242a2a070bc36ca29ed5616">latest_sensor_data_</a>.<a class="code" href="structmachina_1_1service_1_1ndof__sensor__driver_1_1NDofSensorData.html#a799258a81e52e6913433c451e1674fbc">data</a>.data = std::vector&lt;double&gt;(</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;        <span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">double</span>*<span class="keyword">&gt;</span>(data_buffer),</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;        <span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">double</span>*<span class="keyword">&gt;</span>(data_buffer) +</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;            <a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a24ef7b5a804785e4e64e125a8382f3e4">ros_params_</a>.requested_sample_size * <a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a24ef7b5a804785e4e64e125a8382f3e4">ros_params_</a>.degrees_of_freedom);</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="preprocessor">#ifdef ENABLE_LOCKFREE</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    <span class="comment">// If we are using lockfree data structures, we need to store the latest</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <span class="comment">// sensor data in the TACO</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    sensor_data_taco_.store(<a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a3206ca9b5242a2a070bc36ca29ed5616">latest_sensor_data_</a>, ThreadContext::Producer);</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    <span class="comment">// If we are not using lockfree data structures, we need to unlock the mutex</span></div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <span class="comment">// From here we will no longer be modifying the latest sensor data so we can</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    <span class="comment">// unlock the mutex and use a shared lock to allow multiple readers</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    <a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a194b2c9aab529e9c5c02aa186284fcc3">latest_sensor_data_mutex_</a>.unlock();</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a194b2c9aab529e9c5c02aa186284fcc3">latest_sensor_data_mutex_</a>.lock_shared();</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <span class="comment">// Check if the data received is corrupted. We expect the last value to be</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    <span class="comment">// the sum of all the other values. NOTE: This is not the case in the</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <span class="comment">// sensor simulation given. I modified it to act as a CRC of sorts</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <span class="keywordtype">double</span> sum_of_all_vals_except_end =</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        std::accumulate(<a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a3206ca9b5242a2a070bc36ca29ed5616">latest_sensor_data_</a>.<a class="code" href="structmachina_1_1service_1_1ndof__sensor__driver_1_1NDofSensorData.html#a799258a81e52e6913433c451e1674fbc">data</a>.data.begin(),</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;                        <a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a3206ca9b5242a2a070bc36ca29ed5616">latest_sensor_data_</a>.<a class="code" href="structmachina_1_1service_1_1ndof__sensor__driver_1_1NDofSensorData.html#a799258a81e52e6913433c451e1674fbc">data</a>.data.end() - 1, 0.0);</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    <span class="keywordflow">if</span> ((sum_of_all_vals_except_end -</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;         <a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a3206ca9b5242a2a070bc36ca29ed5616">latest_sensor_data_</a>.<a class="code" href="structmachina_1_1service_1_1ndof__sensor__driver_1_1NDofSensorData.html#a799258a81e52e6913433c451e1674fbc">data</a>.data[<a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a24ef7b5a804785e4e64e125a8382f3e4">ros_params_</a>.requested_sample_size *</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;                                           <a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a24ef7b5a804785e4e64e125a8382f3e4">ros_params_</a>.degrees_of_freedom -</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;                                       1]) &gt; 1e-6) {</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;      RCLCPP_ERROR(</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;          get_logger(), <span class="stringliteral">&quot;Data received but corrupted %f %f&quot;</span>,</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;          sum_of_all_vals_except_end,</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;          <a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a3206ca9b5242a2a070bc36ca29ed5616">latest_sensor_data_</a>.<a class="code" href="structmachina_1_1service_1_1ndof__sensor__driver_1_1NDofSensorData.html#a799258a81e52e6913433c451e1674fbc">data</a>.data[<a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a24ef7b5a804785e4e64e125a8382f3e4">ros_params_</a>.requested_sample_size *</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;                                            <a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a24ef7b5a804785e4e64e125a8382f3e4">ros_params_</a>.degrees_of_freedom -</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;                                        1]);</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    }</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;<span class="preprocessor">#ifndef ENABLE_LOCKFREE</span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <span class="comment">// If we are not using lockfree data structures, we are done reading and</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <span class="comment">// validating the sensor data. We can unlock the shared lock now</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    <a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a194b2c9aab529e9c5c02aa186284fcc3">latest_sensor_data_mutex_</a>.unlock_shared();</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <span class="comment">// Debug purposes to see how long it takes to read sensor data. Ideally</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <span class="comment">// should go on a telemetry publisher</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    <span class="keyword">auto</span> end_time = now();</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    int64_t dur =</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        std::max(<span class="keyword">static_cast&lt;</span>int64_t<span class="keyword">&gt;</span>(0),</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;                 <span class="keyword">static_cast&lt;</span>int64_t<span class="keyword">&gt;</span>((end_time - start_time).nanoseconds()));</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    RCLCPP_DEBUG(get_logger(), <span class="stringliteral">&quot;Took %f seconds to read sensor data&quot;</span>,</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;                 dur / 1e9);</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <span class="comment">// Sleep for the polling interval. We will sleep for the remaining time</span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <span class="comment">// after we have read the sensor data</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="keyword">auto</span> sleep_time = std::max(<span class="keyword">static_cast&lt;</span>int64_t<span class="keyword">&gt;</span>(0),</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;                               <a class="code" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a24ef7b5a804785e4e64e125a8382f3e4">ros_params_</a>.sensor_polling_interval - dur);</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    std::this_thread::sleep_for(std::chrono::nanoseconds(sleep_time));</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;  }</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="a3206ca9b5242a2a070bc36ca29ed5616"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3206ca9b5242a2a070bc36ca29ed5616">&#9670;&nbsp;</a></span>latest_sensor_data_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structmachina_1_1service_1_1ndof__sensor__driver_1_1NDofSensorData.html">NDofSensorData</a> machina::service::ndof_sensor_driver::MachinaNDofSensorDriverServiceNode::latest_sensor_data_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Structure to hold the latest sensor data. </p>
<p>If we are not using lock-free methods we need a class member to store the latest sensor data to share b/w threads </p>

</div>
</div>
<a id="a194b2c9aab529e9c5c02aa186284fcc3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a194b2c9aab529e9c5c02aa186284fcc3">&#9670;&nbsp;</a></span>latest_sensor_data_mutex_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::shared_mutex machina::service::ndof_sensor_driver::MachinaNDofSensorDriverServiceNode::latest_sensor_data_mutex_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Mutex to protect the latest sensor data. </p>
<p>If we are not using lock-free methods we need to use a mutex to protect the latest sensor data. This is a shared_mutex so that multiple readers can access the data at the same time </p>

</div>
</div>
<a id="ae42d116b769ecd12f04139eb0d97e9d2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae42d116b769ecd12f04139eb0d97e9d2">&#9670;&nbsp;</a></span>param_listener_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::unique_ptr&lt;ros_parameters::ParamListener&gt; machina::service::ndof_sensor_driver::MachinaNDofSensorDriverServiceNode::param_listener_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Pointer to the ROS 2 parameter listener. Uses the generate_parameter_library package to generate the parameters in a less verbose way. </p>

</div>
</div>
<a id="a24ef7b5a804785e4e64e125a8382f3e4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a24ef7b5a804785e4e64e125a8382f3e4">&#9670;&nbsp;</a></span>ros_params_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">ros_parameters::Params machina::service::ndof_sensor_driver::MachinaNDofSensorDriverServiceNode::ros_params_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Structure to hold the ROS 2 parameters retrieved from the parameter listener. </p>

</div>
</div>
<a id="a2ec5b9fe3ede4f05decc116c1bf5c592"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2ec5b9fe3ede4f05decc116c1bf5c592">&#9670;&nbsp;</a></span>sample_size_buffer_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t* machina::service::ndof_sensor_driver::MachinaNDofSensorDriverServiceNode::sample_size_buffer_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Buffer to hold the sample size of the sensor data. </p>
<p>I allocate it once and then reuse it to avoid memory allocation overhead At a future time point, we may allow the sample size to be dynamic. Though it does mess with memory allocation and deallocation during the "realtime" operation of the node so I am not sure if it is a good idea </p>

</div>
</div>
<a id="a51bf0902a53eae1a83efef5c86d8e515"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a51bf0902a53eae1a83efef5c86d8e515">&#9670;&nbsp;</a></span>sensor_data_buffer_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double* machina::service::ndof_sensor_driver::MachinaNDofSensorDriverServiceNode::sensor_data_buffer_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Buffer to hold the sensor data. </p>
<p>I allocate it once and then reuse it to avoid memory allocation overhead This doesn't need to be thread safe since the sensor data thread is the only one interacting with this. The data gets passed onto <a class="el" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a3206ca9b5242a2a070bc36ca29ed5616">latest_sensor_data_</a> if we are not using lock-free methods. Otherwise it gets stored in sensor_data_taco_ </p>

</div>
</div>
<a id="a9fd6c38d36ccfeb6e2eec81b14e3b690"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9fd6c38d36ccfeb6e2eec81b14e3b690">&#9670;&nbsp;</a></span>sensor_data_service_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">rclcpp::Service&lt;machina_ndof_sensor_driver_msgs::srv::GetLatestSensorData&gt;:: SharedPtr machina::service::ndof_sensor_driver::MachinaNDofSensorDriverServiceNode::sensor_data_service_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Service to get the latest sensor data. </p>

</div>
</div>
<a id="aff435bda6d57fa91d446d23fd9a6d079"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aff435bda6d57fa91d446d23fd9a6d079">&#9670;&nbsp;</a></span>sensor_data_thread_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::thread machina::service::ndof_sensor_driver::MachinaNDofSensorDriverServiceNode::sensor_data_thread_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Thread to read sensor data continuously. </p>
<p>This thread is started in the activate lifecycle transition and stopped in the deactivate lifecycle transition</p>
<p>It reads sensor data continuously and stores it in either <a class="el" href="classmachina_1_1service_1_1ndof__sensor__driver_1_1MachinaNDofSensorDriverServiceNode.html#a3206ca9b5242a2a070bc36ca29ed5616">latest_sensor_data_</a> or sensor_data_taco_ depending on the if we are compiling with lock-free methods or not </p>

</div>
</div>
<a id="a6e6c150997e60dc549284ca9ae455953"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6e6c150997e60dc549284ca9ae455953">&#9670;&nbsp;</a></span>sensor_data_thread_running_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::atomic&lt;bool&gt; machina::service::ndof_sensor_driver::MachinaNDofSensorDriverServiceNode::sensor_data_thread_running_ {false}</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Atomic to check if the sensor data thread is running. </p>
<p>I don't use the LOCKFREE macro here since I think the atomic should always be faster for a boolean. We also assert that it is always lock-free </p>

</div>
</div>
<a id="ad19471695861a3d4c2da5b9c562b230c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad19471695861a3d4c2da5b9c562b230c">&#9670;&nbsp;</a></span>tcp_interface_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::unique_ptr&lt;<a class="el" href="classmachina_1_1tcp__interface_1_1TcpInterface.html">machina::tcp_interface::TcpInterface</a>&gt; machina::service::ndof_sensor_driver::MachinaNDofSensorDriverServiceNode::tcp_interface_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Pointer to the TCP interface. </p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>src/machina_ndof_sensor_driver_service/include/machina_ndof_sensor_driver_service/<a class="el" href="machina__ndof__sensor__driver__service__node_8hpp_source.html">machina_ndof_sensor_driver_service_node.hpp</a></li>
<li>src/machina_ndof_sensor_driver_service/src/<a class="el" href="machina__ndof__sensor__driver__service__node_8cpp.html">machina_ndof_sensor_driver_service_node.cpp</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
